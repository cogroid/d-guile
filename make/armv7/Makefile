all:
	sudo mkdir -p /home/cogroid/local/libtool/armv7
	sudo cp -rf ./libtool/* /home/cogroid/local/libtool/armv7/

	sudo mkdir -p /home/cogroid/local/libgmp/armv7
	sudo cp -rf ./libgmp/* /home/cogroid/local/libgmp/armv7/

	sudo mkdir -p /home/cogroid/local/libunistring/armv7
	sudo cp -rf ./libunistring/* /home/cogroid/local/libunistring/armv7/

	sudo mkdir -p /home/cogroid/local/libffi/armv7
	sudo cp -rf ./libffi/* /home/cogroid/local/libffi/armv7/

	sudo mkdir -p /home/cogroid/local/guile/armv7/lib
	sudo cp -rf ./prebuilt/* /home/cogroid/local/guile/armv7/lib/

	sudo mkdir -p /home/cogroid/local/guile/armv7/include
	sudo cp -rf ./include/* /home/cogroid/local/guile/armv7/include/

	sudo mkdir -p /home/cogroid/local/guile/armv7/bbin
	sudo cp -rf ./bin/* /home/cogroid/local/guile/armv7/bbin/
	sudo rm -f /home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-cc
	sudo ln -s /home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-gcc /home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-cc

	sudo cp -f ./langinfo.h /home/cogroid/local/android-ndk-r18b/sysroot/usr/include/

	cp -f ./pairs.h ../../libguile/
	cp -f ./weak-set.c ../../libguile/
	cp -f ./socket.c ../../libguile/

	cd ../../; \
	export PATH="/home/cogroid/local/guile/armv7/bbin:/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/arm-linux-androideabi/bin:/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin:${PATH}"; \
	./autogen.sh --no-configure; \
	./configure \
	ABI=32 \
	LDFLAGS="-I/home/cogroid/local/guile/armv7/include -I/home/cogroid/local/libunistring/armv7/include -L/home/cogroid/local/libunistring/armv7/lib -B/home/cogroid/local/libunistring/armv7/lib -I/home/cogroid/local/libffi/armv7/lib/libffi-3.2.1/include -L/home/cogroid/local/libffi/armv7/lib -B/home/cogroid/local/libffi/armv7/lib -I/home/cogroid/local/libgmp/armv7/include -L/home/cogroid/local/libgmp/armv7/lib -B/home/cogroid/local/libgmp/armv7/lib -I/home/cogroid/local/libtool/armv7/include -L/home/cogroid/local/libtool/armv7/lib -B/home/cogroid/local/libtool/armv7/lib -v --target=arm-linux-androideabi -march=armv7-a -mfloat-abi=softfp -mfpu=vfp -mthumb -fPIC -fno-integrated-as --sysroot /home/cogroid/local/android-ndk-r18b/sysroot -isystem /home/cogroid/local/android-ndk-r18b/sysroot/usr/include/arm-linux-androideabi -D__ANDROID_API__=26 -fexceptions -frtti -ffunction-sections -funwind-tables -fstack-protector-strong -Wno-invalid-command-line-argument -Wno-unused-command-line-argument -no-canonical-prefixes -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++/include -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++abi/include -I/home/cogroid/local/android-ndk-r18b/sources/android/support/include -DANDROID -Wa,--noexecstack -Wformat -Werror=format-security -DNDEBUG -O2 -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -B/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -L/home/cogroid/local/guile/armv7/lib -B/home/cogroid/local/guile/armv7/lib -lltdl -lfixing -lgmp -lffi -lunistring " \
	CFLAGS="-I/home/cogroid/local/guile/armv7/include -I/home/cogroid/local/libunistring/armv7/include -L/home/cogroid/local/libunistring/armv7/lib -B/home/cogroid/local/libunistring/armv7/lib -I/home/cogroid/local/libffi/armv7/lib/libffi-3.2.1/include -L/home/cogroid/local/libffi/armv7/lib -B/home/cogroid/local/libffi/armv7/lib -I/home/cogroid/local/libgmp/armv7/include -L/home/cogroid/local/libgmp/armv7/lib -B/home/cogroid/local/libgmp/armv7/lib -I/home/cogroid/local/libtool/armv7/include -L/home/cogroid/local/libtool/armv7/lib -B/home/cogroid/local/libtool/armv7/lib -v --target=arm-linux-androideabi -march=armv7-a -mfloat-abi=softfp -mfpu=vfp -mthumb -fPIC -fno-integrated-as --sysroot /home/cogroid/local/android-ndk-r18b/sysroot -isystem /home/cogroid/local/android-ndk-r18b/sysroot/usr/include/arm-linux-androideabi -D__ANDROID_API__=26 -fexceptions -frtti -ffunction-sections -funwind-tables -fstack-protector-strong -Wno-invalid-command-line-argument -Wno-unused-command-line-argument -no-canonical-prefixes -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++/include -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++abi/include -I/home/cogroid/local/android-ndk-r18b/sources/android/support/include -DANDROID -Wa,--noexecstack -Wformat -Werror=format-security -DNDEBUG -O2 -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -B/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -L/home/cogroid/local/guile/armv7/lib -B/home/cogroid/local/guile/armv7/lib -lltdl -lfixing -lgmp -lffi -lunistring " \
	CPPFLAGS="-I/home/cogroid/local/guile/armv7/include -I/home/cogroid/local/libunistring/armv7/include -L/home/cogroid/local/libunistring/armv7/lib -B/home/cogroid/local/libunistring/armv7/lib -I/home/cogroid/local/libffi/armv7/lib/libffi-3.2.1/include -L/home/cogroid/local/libffi/armv7/lib -B/home/cogroid/local/libffi/armv7/lib -I/home/cogroid/local/libgmp/armv7/include -L/home/cogroid/local/libgmp/armv7/lib -B/home/cogroid/local/libgmp/armv7/lib -I/home/cogroid/local/libtool/armv7/include -L/home/cogroid/local/libtool/armv7/lib -B/home/cogroid/local/libtool/armv7/lib -v --target=arm-linux-androideabi -march=armv7-a -mfloat-abi=softfp -mfpu=vfp -mthumb -fPIC -fno-integrated-as --sysroot /home/cogroid/local/android-ndk-r18b/sysroot -isystem /home/cogroid/local/android-ndk-r18b/sysroot/usr/include/arm-linux-androideabi -D__ANDROID_API__=26 -fexceptions -frtti -ffunction-sections -funwind-tables -fstack-protector-strong -Wno-invalid-command-line-argument -Wno-unused-command-line-argument -no-canonical-prefixes -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++/include -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++abi/include -I/home/cogroid/local/android-ndk-r18b/sources/android/support/include -DANDROID -Wa,--noexecstack -Wformat -Werror=format-security -DNDEBUG -O2 -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -B/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -L/home/cogroid/local/guile/armv7/lib -B/home/cogroid/local/guile/armv7/lib -lltdl -lfixing -lgmp -lffi -lunistring " \
	CXXFLAGS="-I/home/cogroid/local/guile/armv7/include -I/home/cogroid/local/libunistring/armv7/include -L/home/cogroid/local/libunistring/armv7/lib -B/home/cogroid/local/libunistring/armv7/lib -I/home/cogroid/local/libffi/armv7/lib/libffi-3.2.1/include -L/home/cogroid/local/libffi/armv7/lib -B/home/cogroid/local/libffi/armv7/lib -I/home/cogroid/local/libgmp/armv7/include -L/home/cogroid/local/libgmp/armv7/lib -B/home/cogroid/local/libgmp/armv7/lib -I/home/cogroid/local/libtool/armv7/include -L/home/cogroid/local/libtool/armv7/lib -B/home/cogroid/local/libtool/armv7/lib -v --target=arm-linux-androideabi -march=armv7-a -mfloat-abi=softfp -mfpu=vfp -mthumb -fPIC -fno-integrated-as --sysroot /home/cogroid/local/android-ndk-r18b/sysroot -isystem /home/cogroid/local/android-ndk-r18b/sysroot/usr/include/arm-linux-androideabi -D__ANDROID_API__=26 -fexceptions -frtti -ffunction-sections -funwind-tables -fstack-protector-strong -Wno-invalid-command-line-argument -Wno-unused-command-line-argument -no-canonical-prefixes -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++/include -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++abi/include -I/home/cogroid/local/android-ndk-r18b/sources/android/support/include -DANDROID -Wa,--noexecstack -Wformat -Werror=format-security -DNDEBUG -O2 -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -B/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -L/home/cogroid/local/guile/armv7/lib -B/home/cogroid/local/guile/armv7/lib -lltdl -lfixing -lgmp -lffi -lunistring " \
	--build=i386-linux-gnu \
	--host=arm-linux-androideabi \
	--without-libltdl-prefix \
	--without-libgmp-prefix \
	--without-libunistring-prefix \
	--prefix=/home/cogroid/local/guile/armv7 --docdir=/home/cogroid/local/guile/armv7/share/doc/guile-2.2.3 --host=arm-linux-androideabi;

libfixing.so: ./fixing.c
	/home/cogroid/local/android-ndk-r18b/toolchains/llvm/prebuilt/linux-x86_64/bin/clang -v --target=arm-linux-androideabi -march=armv7-a -gcc-toolchain /home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64 -mfloat-abi=softfp -mfpu=vfp -mthumb -fPIC -fno-integrated-as --sysroot /home/cogroid/local/android-ndk-r18b/sysroot -isystem /home/cogroid/local/android-ndk-r18b/sysroot/usr/include/arm-linux-androideabi -D__ANDROID_API__=26 -fexceptions -frtti -ffunction-sections -funwind-tables -fstack-protector-strong -Wno-invalid-command-line-argument -Wno-unused-command-line-argument -no-canonical-prefixes -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++/include -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++abi/include -I/home/cogroid/local/android-ndk-r18b/sources/android/support/include -DANDROID -Wa,--noexecstack -Wformat -Werror=format-security -DNDEBUG -O2 -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/usr/lib32 -L/usr/lib/x86_64-linux-gnu -B/usr/lib/x86_64-linux-gnu -L/home/cogroid/local/guile/armv7/lib -B/home/cogroid/local/guile/armv7/lib -shared -o ./prebuilt/libfixing.so ./fixing.c

clean:
	cd ../../; \
	make clean

build:
	cd ../../; \
	export FLAGS="-I/home/cogroid/local/guile/armv7/include -I/home/cogroid/local/libunistring/armv7/include -L/home/cogroid/local/libunistring/armv7/lib -B/home/cogroid/local/libunistring/armv7/lib -I/home/cogroid/local/libffi/armv7/lib/libffi-3.2.1/include -L/home/cogroid/local/libffi/armv7/lib -B/home/cogroid/local/libffi/armv7/lib -I/home/cogroid/local/libgmp/armv7/include -L/home/cogroid/local/libgmp/armv7/lib -B/home/cogroid/local/libgmp/armv7/lib -I/home/cogroid/local/libtool/armv7/include -L/home/cogroid/local/libtool/armv7/lib -B/home/cogroid/local/libtool/armv7/lib -v --target=arm-linux-androideabi -march=armv7-a -mfloat-abi=softfp -mfpu=vfp -mthumb -fPIC -fno-integrated-as --sysroot /home/cogroid/local/android-ndk-r18b/sysroot -isystem /home/cogroid/local/android-ndk-r18b/sysroot/usr/include/arm-linux-androideabi -D__ANDROID_API__=26 -fexceptions -frtti -ffunction-sections -funwind-tables -fstack-protector-strong -Wno-invalid-command-line-argument -Wno-unused-command-line-argument -no-canonical-prefixes -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++/include -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++abi/include -I/home/cogroid/local/android-ndk-r18b/sources/android/support/include -DANDROID -Wa,--noexecstack -Wformat -Werror=format-security -DNDEBUG -O2 -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -B/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -L/home/cogroid/local/guile/armv7/lib -B/home/cogroid/local/guile/armv7/lib -lltdl -lfixing -lgmp -lffi -lunistring "; \
	export LDFLAGS="${FLAGS}"; \
	export CFLAGS="${FLAGS}"; \
	export CPPFLAGS="${FLAGS}"; \
	export CXXFLAGS="${FLAGS}"; \
	export PATH="/home/cogroid/local/guile/armv7/bbin:/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/arm-linux-androideabi/bin:/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin:${PATH}"; \
	make

update_makefile:
	cd ../../; \
	./make/armv7/chmkfl.sh

install:
	sudo sh -c 'cd ../../; \
	export FLAGS="-I/home/cogroid/local/guile/armv7/include -I/home/cogroid/local/libunistring/armv7/include -L/home/cogroid/local/libunistring/armv7/lib -B/home/cogroid/local/libunistring/armv7/lib -I/home/cogroid/local/libffi/armv7/lib/libffi-3.2.1/include -L/home/cogroid/local/libffi/armv7/lib -B/home/cogroid/local/libffi/armv7/lib -I/home/cogroid/local/libgmp/armv7/include -L/home/cogroid/local/libgmp/armv7/lib -B/home/cogroid/local/libgmp/armv7/lib -I/home/cogroid/local/libtool/armv7/include -L/home/cogroid/local/libtool/armv7/lib -B/home/cogroid/local/libtool/armv7/lib -v --target=arm-linux-androideabi -march=armv7-a -mfloat-abi=softfp -mfpu=vfp -mthumb -fPIC -fno-integrated-as --sysroot /home/cogroid/local/android-ndk-r18b/sysroot -isystem /home/cogroid/local/android-ndk-r18b/sysroot/usr/include/arm-linux-androideabi -D__ANDROID_API__=26 -fexceptions -frtti -ffunction-sections -funwind-tables -fstack-protector-strong -Wno-invalid-command-line-argument -Wno-unused-command-line-argument -no-canonical-prefixes -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++/include -I/home/cogroid/local/android-ndk-r18b/sources/cxx-stl/llvm-libc++abi/include -I/home/cogroid/local/android-ndk-r18b/sources/android/support/include -DANDROID -Wa,--noexecstack -Wformat -Werror=format-security -DNDEBUG -O2 -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -B/home/cogroid/local/android-ndk-r18b/platforms/android-24/arch-arm/usr/lib -L/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -B/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a/thumb -L/home/cogroid/local/guile/armv7/lib -B/home/cogroid/local/guile/armv7/lib -lltdl -lfixing -lgmp -lffi -lunistring "; \
	export LDFLAGS="${FLAGS}"; \
	export CFLAGS="${FLAGS}"; \
	export CPPFLAGS="${FLAGS}"; \
	export CXXFLAGS="${FLAGS}"; \
	export PATH="/home/cogroid/local/guile/armv7/bbin:/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/arm-linux-androideabi/bin:/home/cogroid/local/android-ndk-r18b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin:${PATH}"; \
	make install;'
	sudo rm -rf /home/cogroid/local/guile/armv7/bbin
	sudo rm -rf /home/cogroid/local/guile/armv7/include/gc
	sudo cp ../../libguile/.libs/libguile-2.2.so /home/cogroid/local/guile/armv7/lib/libguile-2.2.so.1.3.0
	sudo ln -s /home/cogroid/local/guile/armv7/lib/libguile-2.2.so.1.3.0 /home/cogroid/local/guile/armv7/lib/libguile-2.2.so.1
	sudo ln -s /home/cogroid/local/guile/armv7/lib/libguile-2.2.so.1.3.0 /home/cogroid/local/guile/armv7/lib/libguile-2.2.so
